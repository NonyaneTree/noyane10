<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forex Trading</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        body {
            background-color: #1e1e2f;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        canvas {
            background-color: #2d2d44;
            margin: 20px auto;
            display: block;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .balance {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .trade-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .trade-panel input {
            padding: 10px;
            font-size: 16px;
            width: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Forex Trading</h1>
        <div class="balance">
            Balance: <span id="balance">0 Rands</span>
        </div>
        <div class="trade-panel">
            <select id="pair">
                <option value="Nasdaq">Nasdaq (Q)</option>
                <option value="SP500">S&P 500 (Z)</option>
                <option value="AUDUSD">AUD/USD</option>
                <option value="USDZAR">USD/ZAR</option>
            </select>
            <input type="number" id="lotSize" placeholder="Lot Size" min="1" value="1">
            <button onclick="openTrade('buy')">Buy</button>
            <button onclick="openTrade('sell')">Sell</button>
            <button onclick="addFunds()">Add Funds</button>
            <button onclick="withdrawFunds()">Withdraw</button>
        </div>
        <canvas id="forexChart" width="800" height="400"></canvas>
    </div>

    <script>
        // Fetch initial balance from localStorage
        let balance = parseFloat(localStorage.getItem("balance")) || 30000000; // Starting balance in Rands
        document.getElementById('balance').textContent = balance.toLocaleString() + ' Rands';

        let chartData = {
            labels: [], // Time labels
            datasets: [{
                label: 'Price',
                data: [], // Price data
                borderColor: '#4CAF50',
                borderWidth: 2,
                fill: false
            }]
        };

        // Chart Configuration
        const ctx = document.getElementById('forexChart').getContext('2d');
        const forexChart = new Chart(ctx, {
            type: 'line',
            data: chartData,
            options: {
                scales: {
                    y: {
                        beginAtZero: false
                    }
                },
                plugins: {
                    annotation: {
                        annotations: {
                            wFormation: {
                                type: 'line',
                                borderColor: 'blue',
                                borderWidth: 2,
                                label: {
                                    content: 'W Formation',
                                    enabled: true,
                                    position: 'start'
                                },
                                // Example coordinates, adjust as needed
                                xMin: 2,
                                xMax: 4,
                                yMin: 50,
                                yMax: 60
                            },
                            mFormation: {
                                type: 'line',
                                borderColor: 'red',
                                borderWidth: 2,
                                label: {
                                    content: 'M Formation',
                                    enabled: true,
                                    position: 'start'
                                },
                                // Example coordinates, adjust as needed
                                xMin: 5,
                                xMax: 7,
                                yMin: 60,
                                yMax: 50
                            },
                            // Add more formations here
                        }
                    }
                }
            }
        });

        // Simulate Real-Time Data Updates
        function updateChart() {
            const newPrice = chartData.datasets[0].data.length > 0 ?
                chartData.datasets[0].data[chartData.datasets[0].data.length - 1] + (Math.random() - 0.5) * 10 :
                100; // Starting price
            chartData.labels.push(new Date().toLocaleTimeString());
            chartData.datasets[0].data.push(newPrice);
            forexChart.update();
        }
        setInterval(updateChart, 1000); // Update every second

        // Open Trade
        function openTrade(type) {
            const pair = document.getElementById('pair').value;
            const lotSize = parseInt(document.getElementById('lotSize').value);
            const currentPrice = chartData.datasets[0].data[chartData.datasets[0].data.length - 1];

            if (!currentPrice) {
                alert('No price data available.');
                return;
            }

            const tradeAmount = lotSize * currentPrice;

            if (tradeAmount > balance) {
                alert('Insufficient funds!');
                return;
            }

            balance -= tradeAmount;
            localStorage.setItem("balance", balance); // Update balance in localStorage
            updateBalance();

            // Simulate Trade Outcome
            setTimeout(() => {
                const outcome = Math.random() > 0.5 ? 'win' : 'loss';
                const profitLoss = outcome === 'win' ? tradeAmount * 1.1 : tradeAmount * 0.9;
                balance += profitLoss;
                localStorage.setItem("balance", balance); // Update balance in localStorage
                updateBalance();
                alert(`Trade ${outcome}! ${profitLoss.toFixed(2)} Rands ${outcome === 'win' ? 'gained' : 'lost'}.`);
            }, 5000); // Simulate 5-second trade
        }

        // Add Funds
        function addFunds() {
            const amount = parseFloat(prompt('Enter amount to add:'));
            if (!isNaN(amount)) {
                balance += amount;
                localStorage.setItem("balance", balance); // Update balance in localStorage
                updateBalance();
            }
        }

        // Withdraw Funds
        function withdrawFunds() {
            const amount = parseFloat(prompt('Enter amount to withdraw:'));
            if (!isNaN(amount) && amount <= balance) {
                balance -= amount;
                localStorage.setItem("balance", balance); // Update balance in localStorage
                updateBalance();
                alert(`Withdrawn ${amount} Rands.`);
            } else {
                alert('Invalid amount or insufficient balance.');
            }
        }

        // Update Balance Display
        function updateBalance() {
            document.getElementById('balance').innerText = balance.toLocaleString() + ' Rands';
        }
    </script>
</body>
</html>
